$Id: INSTALL,v 1.2 2004/03/28 00:53:36 nobsun Exp $

Installation procedure

[Short Summary]

  % ./configure --with-cgidir=$(KAHUA_CGIDIR)
  % make
  % make check
  % su
  # make install
  # vi $(CONFFILE)
  # chgrp -R $(KAHUA_GROUP) $(KAHUA_DIRS)
  # chmod -R g+ws $(KAHUA_DIRS)
  # exit
  % make install-examples
  % vi $(KAHUA_WORK_DIR)/app-servers
  % (kahua-spvr > /dev/null 2>&1) &

[Step by step]

1. Configuration and make
-------------------------

  % ./configure --with-cgidir=$(KAHUA_CGIDIR)
  % make

You need to give a directory name where cgi scripts should be installed
by --with-cgidir option.   If the option is omitted, /usr/local/libexec/kahua
is used.  But it should differ by your httpd settings, so make sure
your httpd recognizes the files under that directory as cgi scripts.

Optionally, you can give --with-cgidir=no (or --without-cgidir) to
prevent 'make' from installing cgi scripts automatically.  In such
a case, you need to copy scripts under cgi/ manually to the
desired location.

You can run a self test by 'make check'.

  % make check


2. Installation
---------------

Installation process writes to several locations.   You have to
have permissions to do so.

  $(prefix)/tmp/kahua    : This directory is created for Unix domain sockets
                           kahua servers will use.  You can specify it
                           in the kahua.conf file which by default installed
                           in $(sysconfdir)/kahua
  $(localstatedir)/kahua : This directory is created for kahua to save various
                           informations, including database.
  $(KAHUA_CGIDIR)        : CGI scripts will be copied to the directory
                           given to --with-cgidir configure option.
  $(sysconfdir)/kahua    : kahua.conf will be copied in this location.
  $(bindir)/kahua        : Kahua commands (shell scripts) will be copied to
                           this location.
  $(libexecdir)/kahua    : Kahua executables called by kahua commands will be
                           copied to this location.
  $(libdir)/kahua        : Kahua modules will be copied to this location.

"make install" will do the job.


3. Setting up
-------------

Check the file $(sysconfdir)/kahua.conf and edit it if necessary.

During its normal operation, the Kahua system needs to write
to the following directories:

 - socket directory (specified by :sockbase in kahua.conf;
   the default is $(prefix)/tmp/kahua)

 - working directory (specified by :working-directory
   in kahua.conf; the default is $(localstatedir)/kahua)

 - document directory (specified by :static-document-path
   in kahua.conf; the default is /var/www/kahua)
   This directory is not created by 'make install'.
   You need to make sure creating this directory.

The write permissions of these directories should be open
to the user/group who runs Kahua servers.  One strategy is
to create a group 'kahua' and chgrp those directories,
then put the users that adminsters Kahua servers to the
group.


4. Running Examples
-------------------

Run "make install-examples" to install an example application
servers, "lambdabooks", "wiki-iki", "login", "nqueen" "lazy-nqueen", and
"lambdacalcul".

  % make install-examples

Check $(localstatedir)/kahua/app-servers file and make sure
it contains the following line.  By default, unless you have
already created app-servers file, "make install-examples"
copies a sample app-servers file that contains the following
entry.

 (lambdabooks   :arguments () :run-by-default 1)
 (wiki-iki      :arguments () :run-by-default 1)
 (login         :arguments () :run-by-default 1)

And run Kahua main server.

  % (kahua-spvr > /dev/null 2>&1) &

You can access the site via kahua-elua.cgi CGI script from
your browser, for example, by specifying kahua.cgi/lambdabooks as URI
to connect to the demo server.

