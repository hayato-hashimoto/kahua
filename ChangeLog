2004-02-26  Shiro Kawai  <shiro@acm.org>

	* src/kahua/persistence.scm : implemented schema generation control;
	the module compares it's in-memory persistent class generation and
	in-db persistent class generation, and upgrades/downgrades the
	instance automatically when reading the data into memory.  At the
	commitment time, the in-db persistent instance is upgraded iff
	in-memory generation is newer than in-db generation.
	* test/persistence.scm : added tests for the above change.
	Also a detailed description of tests are written (currently in
	Japanese euc-jp).

2004-02-26  Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* cgi/kahua.cgi.in: fixed PATH_INFO bugs.
	fixed some error representation.

2004-02-25  Yusei Tahara  <tahara@timedia.co.jp>

	* src/kahua/plugin.scm: added use-plugin to export.
	* src/kahua/sandbox.scm (make-sandbox-module):
	disable bindings import and require.
	* test/shell.scm, test/testuser.conf: added kahua-shell test.
	* test/usermode.scm: added user exclusive mode test.
	* test/sandbox.scm: added sandbox test.
	* test/plugin.scm: added plugin test.
	* test/Makefile: added 'shell', 'usermode', 'plugin',
	'sandbox' make target.

2004-02-23  Koichi Sasada <sasada@namikilab.taut.ac.jp>

	* src/kahua-spvr.in : bug fixed about ping.
	* src/kahua-server.in (update-server): 
	renamed 'reload-server to update-server. supported updating specified
	file.
	* src/kahua-admin.in : supported 'update' command.
	supported redo command as ":".
	* test/admin.in : add 'update' test.

2004-02-23  Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* src/kahua-spvr.in (unexpected-end): 
	added dummy procedure to hook unexpected end of a worker.
	
2004-02-23  Yusei Tahara  <tahara@timedia.co.jp>

	* emacs/kahua.el.in, emacs/kahua-shell.el:
	added kahua-user-mode variable for connecting user-mode spvr.
	* src/kahua-shell.in (login-processor): when run with -user option,
	omit username prompt.
	* src/kahua/developer.scm
	(developer-roles): added developer role.
	(kahua-add-developer): added roles argument.
	* src/kahua-admin.in, src/user.conf.sample: added developer role.
	* test/developer.scm: changed kahua-add-developer argument.

2004-02-22  Shiro Kawai  <shiro@acm.org>

	* src/kahua-server.in (handle-request): opens the default database
	($working-directory/db) if primary-database-name isn't specified.
	Since several application servers need to share the database if they
	pass control around, now it is strongly recommended for app servers
	to use the default database instead of specifying its own database
	by primary-database-name; in future, there will be different
	mechanism to allow app servers to use multiple databases.

	* src/examples/login/login.kahua : added. An example that handles
	user login.
	* src/examples/wiki-iki/wiki-iki.kahua : added link to login.
	* src/examples/app-servers.sample : added login.kahua.
	* src/examples/Makefile.in : added login.kahua.

	* src/examples/lambdabooks/lambdabooks.kahua : removed
	primary-database-name to use the default db.
	* src/examples/lambdabooks.init : use the default db.

	* src/kahua/persistence.scm (lock-db): sleep before retrying locking
	the DB.

2004-02-23  Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* src/kahua-spvr.in : supported restarting a server which has no
	response.
	modified some log format.
	added 'worker-zombee slot to recognize that worker is zombee or not.

	* src/kahua-server.in : modify to achieve above. if header has
	"x-kahua-ping", reply to client (values #t #t).

	* src/kahua/config.scm : add slot 'ping-timeout-sec and 
	'ping-interval-sec.
	
2004-02-22  Yusei Tahara  <tahara@timedia.co.jp>

	* src/kahua-shell.in (make-worker-command-processor):
	sending expression evaluate in sandbox instead of kahua-server.
	* src/kahua-admin.in, src/kahua/plugin.scm:
	added plugin command. this command provides listing and reloading.

2004-02-22  Shiro Kawai  <shiro@acm.org>

	* src/kahua/server.scm (a/cont) : supports remote-cont clause, which
	allows the application server to pass the control to another
	application server.

2004-02-21  Shiro Kawai  <shiro@acm.org>

	* src/kahua-keyserv.in : added - session-key server.
	* src/kahua-server.in : added -k option to receiver session-key server
	identifier.
	* src/kahua-spvr.in : fork session-key server at startup, and passes
	its identifier to kahua-servers.  Also refactored run-piped-cmd.
	* src/kahua/server.scm (kahua-init-server) : takes an optional
	argument session-server-id, in case if session-key server is used.
	* src/kahua/session.scm :
	(session-manager-init): takes an optional argument session-server-id,
	in case if session-key server is used.
	(<session-state>, session-state-register, session-state-get,
	session-state-discard, session-state-sweep, session-state-refresh):
	If session-key server is used, query the state session id to it.
	* src/Makefile.in : added kahua-keyserv
	* test/session.scm : added tests that works with session-key server.
	* test/sharedstate.kahua : added to test shared state-session key
	via session-key server.
	* test/spvr.scm : added tests for sharedstate.kahua.
	
	* plugins/allow-module.scm : allow gauche.vm.debugger - it is
	implicitly used by '#?=' debug-print feature.
	* test/allow-module.scm : removed, for it is redundant with
	plugins/allow-module.scm
	* test/admin.scm, test/lambdabooks.scm, test/nqueen.scm,
	test/worker.scm : changed to get allow-module.scm from ../plugins.

2004-02-20  Shiro Kawai  <shiro@acm.org>

	* src/kahua/util.scm (kahua-error-string): the implementation of
	detail? optional argument didn't meet the comment.  Fixed
	implementation to match the comment.

2004-02-20  Yusei Tahara  <tahara@timedia.co.jp>

	* src/kahua-install.in: added new -t type plugin.
	* src/kahua-server.in:
	(kahua-application-environment): added. make anonymous sandbox module.
	(kahua-app-server): now this is a sandbox module object, not a module.
	(load-kahua-module): changed load environment. use sandbox module.
	this procedue is defined as "load" in sandbox module.
	(kahua-server-main): initialize plugins before loading *.kahua.
	* src/kahua/plugin.scm: added plugin manager.
	* src/kahua/sandbox.scm: added safe environment module.
	* src/Makefile.in: install kahua/sandbox.scm kahua/plugin.scm.
	added /var/lib/kahua/user /var/lib/kahua/plugins in CREATE_DIRS.
	* src/kahua.scm: added kahua.plugin and kahua.sandbox.
	* test/admin.scm, test/lambdabooks.scm, test/nqueen.scm,
	  test/spvr.scm, test/wiki-iki.scm, test/worker.scm:
	make plugins directory in working directory and copy
	allow-module.scm to it.
	* plugins/Makefile.in, plugins/allow-module.scm, plugins/sendmail.scm:
	added sample plugins.

2004-02-20  Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* src/kahua-spvr.in : modified to run servers such as different
	to app-servers description when 'reload' command is executed.
	and changed a return value of 'reload' command to available types.

	* test/spvr.scm, test/admin.scm : modified to support above. 

2004-02-19  Nobuo Yamashita  <nobsun@sampou.org>

	* src/kahua/elem.scm : added higher-order tag functions
	
	* src/kahua/server.scm (kahua-render-proc) : A little modified
	for handling higher-order nodes.

	* test/*-st.kahua: Sample for higher-order tag functions
	
	* test/worker.scm: added test for *-st.kahua
	
2004-02-18  Shiro Kawai  <shiro@acm.org>

	* src/kahua/developer.scm (save-conf): made it more robust to save
	user.conf.

	* src/kahua/gsid.scm (make-worker-id): do not include worker type
	in the worker id.   It is redundant.
	* src/kahua/persistence.scm (kahua-serializable-object?): added.
	* src/kahua/session.scm:
	(slot-missing class (obj <session-state>) slot val): check if
	the value is serializable.
	* src/kahua-admin.in (make-worker-command-processor): changed prompt
	to use worker type explicitly (since worker id doesn't include
	worker type anymore).
	* src/kahua-shell.in (make-worker-command-processor): ditto.

2004-02-17  Yusei Tahara  <tahara@timedia.co.jp>

	* cgi/kahua.cgi.in:
	(response): added. provide control over output headers.
	(publisher): added. publish html and provide ~user authentication.
	(compose-reply): changed. compose-reply use response dispatcher
	for setting headers and cookies.

2004-02-17  Nobuo Yamashita  <nobsun@sampou.org>

	* src/kahua/elem.scm: added node-set: and node-list-to-node-set.
	All tag functions flatten their args by checking node-set tag.

	* src/kahua/server.scm (kahua-render-proc) : A little modified
	for handling top level node-set.
	
2004-02-17  Yusei Tahara  <tahara@timedia.co.jp>

	* src/kahua/config.scm (kahua-init): bug fix. do sanity-check after
	loading user custom.conf.
	* cgi/kahua.cgi.in (load-user-config): change specification.
	when PATH_INFO has ~user component, load the custom.conf and
	connect user's spvr. don't tie to unix account.

2004-02-16  Yusei Tahara  <tahara@timedia.co.jp>

	* src/custom.conf.sample: added configuration file for user mode.
	* src/kahua/config.scm
	(<kahua-custom>): added. and added new internal slot, "user-mode" for
	running user mode. when running under user mode, "user-mode" value
	is a user name.
	(<kahua-config>): change inheritance. now <kahua-config> inherit
	two classes, <kahua-custom> and <singleton-mixin>.
	(kahua-init): change arguments. now "cfile" must need.
	"user" and "skip-check?" are optional keyword arguments.
	when apply "user" argument, load the user's "custom.conf"
	after "kahua.conf".
	* src/kahua-server.in (kahua-server-main):added optional argument
	"-user" for running user mode.
	* src/kahua-spvr.in
	(worker-script): when running under user mode, run kahua-server process
	with "-user" argument.
	(main): added optinal argument "-user" for running user mode.
	* src/kahua-shell.in (main): added optional argument "-user"
	for running user mode.
	* src/kahua-admin.in (spvr-command-processor): added help command list.
	adduser, deluser, lsuser.
	(main): added optional argument "-user" for running user mode.

2004-02-15  Yusei Tahara  <tahara@timedia.co.jp>

	* emacs/kahua.el.in: added the custom group 'kahua' and variables.
	* emacs/kahua-shell.el.in: use custom variables for ssh username
	and hostname. added select worker prompt hook.

2004-02-15  Nobuo Yamashita  <nobsun@sampou.org>

	* test/*.kahua: changed tags from symbol to function.
	
2004-02-14  Nobuo Yamashita  <nobsun@sampou.org>
	
	* src/kahua/elem.scm: newly added. It provides html tags implemented
	as functions.
	* src/kahua.scm: added kahua.elem.
	
2004-02-14  Yusei Tahara  <tahara@timedia.co.jp>

	* emacs/kahua-shell.el.in: added remote emacs interface. can use 'run-kahua-shell' like 'run-scheme'.
	* emacs/Makefile.in: added 'kahua-shell.el' make target.
	* src/kahua-shell.in (login-processor): if stdin is not a terminal,
	password prompt is echoed.

2004-02-11  Nobuo Yamashita  <nobsun@sampou.org>

	* examples/lazy-nqueen/lazy-nqueen.kahua : improved laziness.
	Function applications are delayed instead args of cons.

	* test/nqueen.scm : modified a little.
	
2004-02-10  Nobuo Yamashita  <nobsun@sampou.org>

	* examples/lazy-nqueen/lazy-nqueen.kahua : added.

	* test/nqueen.scm : added test part for examples/lazy-nqueen.
	
2004-02-08  Shiro Kawai  <shiro@acm.org>

	* src/kahua/persistence.scm : records persistent class information
	as <kahua-persistent-metainfo> persistent object.
	* test/persistence.scm : updated accordingly.

	* src/kahua/test/worker.scm (call-worker/gsid->sxml): added.
	(make-match&pick) : dropped the support of extra sxpath spec.
	it is easier to apply sxpath in call-worker/gsid->sxml instead
	of here; it will produce comprehensive error log.
	Also decode uri encoding.

	* test/nqueen.scm : added to test examples/nqueen.

2004-02-06  Shiro Kawai  <shiro@acm.org>

	* src/kahua/partcont.scm, test/partcont.scm :
	(reset/pc, call/pc, let/pc) : implemented partial continuation
	according to Gasbichler&Sperber ICFP02 paper.
	* src/kahua/kahua.scm : extends kahua.partcont
	* src/kahua/server.scm : wrap handler invocation by reset/pc,
	so that the partial continuation captured in the application-server
	returns correctly.

	* examples/nqueen/nqueen.kahua : added an example that uses
	partial continuation (nqueen code by Koichi Sasada).

	* examples/lambdabooks/login.kahua : slightly revised using
	entry-lambda

2004-02-03  Nobuo Yamashita  <nobsun@sampou.org>

	* src/kahua/server.scm : replaced sxml:string->xml with 
	sxml:string->html
	
2004-02-02  Yusei Tahara  <tahara@timedia.co.jp>

	* src/kahua-admin, test/admin.scm : added "adduser", "deluser", "lsuser" commands for the developer account management.

	* src/kahua-admin, src/kahua-spvr : fixed "help" command. now it shows all the commands on both scripts.

2004-01-29  Yusei Tahara  <tahara@timedia.co.jp>

	* src/kahua/developer.scm, src/user.conf.sample : added the developer account.
	* src/kahua/test/developer.scm : added.
	
	* src/kahua-shell.in : added the REPL interface for kahua developers.

	* src/kahua.conf.sample (userconf-file), src/kahua/config.scm :
	added userconf-file slot

2004-01-25  Shiro Kawai  <shiro@acm.org>

	* src/kahua/session.scm :
	(<session-cont>): added permanent? slot
	(session-cont-register): set permanent? #t for permanent entries
	(session-cont-sweep): avoid sweeping permanent entries.

2004-01-24  Shiro Kawai  <shiro@acm.org>

	* src/kahua/user.scm (kahua-user-password-change): added.

2004-01-23  Shiro Kawai  <shiro@acm.org>

	* src/kahua-spvr.in (main): fixed a bug that kahua-spvr removes
	the socket on exit when it detects another kahua-spvr is running.

	* src/kahua/server.scm (a/cont): allow 'fragment' parameter to aux
	list, to specify fragment id of generated uri.

2004-01-22  Shiro Kawai  <shiro@acm.org>

	* src/kahua/server.scm (kahua-default-handler): process error-proc's
	result by render-proc, so that error-proc can return [SXML].

	* src/kahua-server.in (kahua-error-proc): new parameter to customize
	error-handling routine.
	
	* src/kahua/persistence.scm (initialize): fixed a problem when
	class definition is changed to remove an existing slot.

	* src/kahua/server.scm (form/cont): allow to pass extra parameters
	to the continuation closure, much like a/cont.

	* src/kahua/util.scm: added.
	* src/kahua.scm: added kahua.util

2004-01-20  Shiro Kawai  <shiro@acm.org>

	* cgi/kahua.cgi.in (compose-reply): pass through the extra
	headers given in the reply.
	(get-path-info): fixed a problem when PATH_INFO is "/".
	(server-uri): pass the server's absolute uri to the application
	server via "x-kahua-server-uri" header.
	
	* src/kahua/server.scm :
	(kahua-default-handler): let render-proc return (Stree, Context)
	instead of just Stree, so that it can inject information into
	Context.   Specifically, a context "extra-headers" is used
	as an additional header fields of reply message.
	(extra-header): a new SXML element, which doesn't produce any
	visual node but just inject a reply header.
	(define-entry): added support of :rest argument.
	(kahua-server-uri): provided the means to extract server's absolute
	uri, which is passed from kahua.cgi.
	(kahua-self-uri, kahua-self-uri-full): added.  utilities to build
	self-referencing uri.
	
	* test/server.scm : updated accordingly.

	* src/Makefile.in (SCMFILES): install kahua/test/*.scm as well.

2004-01-18  Shiro Kawai  <shiro@acm.org>

	* src/kahua/server.scm : removed bogus reference to kahua.app module.

2004-01-15  Shiro Kawai  <shiro@acm.org>

	* src/kahua/html.scm : merged into kahua/server.scm
	* src/kahua/server.scm :
	(kahua-current-context) : context is kept in this global parameter.
	(kahua-default-handler) : changed calling convention of content
	handlers.  Now the handler is () -> [SXML], and completely decoupled
	from the rendering routine, whose default is interp-html.  Also,
	the extra path info is passed in context.
	(kahua-context-ref) : dropped 'context' argument, for it is now
	obtained from kahua-current-context.
	(kahua-context-add) : dropped, for it is not used at all.
	(kahua-current-user) : dropped 'context' argument, for it is now
	obtained from kahua-current-context.
	(define-entry) : allow the handler to take positional and/or
	query arguments.
	(entry-lambda) : new macro that is the core part of parsing
	positional and query arguments for entry procedures.
	(a/cont) : allow to specify positional and query arguments for
	continuation, which will be rendered in a link url.
	
	* src/kahua/test/worker.scm (make-match&pick) : added handling of
	extra path-info.
	
	* examples/*, test/* : reflected above changes.

2004-01-14  Shiro Kawai  <shiro@acm.org>

	* src/kahua/server.scm (kahua-default-handler): passes path-info
	  to the handling procedure using the context ("x-kahua-path-info").

2004-01-13  Shiro Kawai  <shiro@acm.org>

	* src/kahua/dbm.scm, test/kahua-dbm.scm : added a module that
	  provides dbm interface on top of kahua.persistence.

2004-01-12  Shiro Kawai  <shiro@acm.org>

	* Makefile.in, cgi/Makefile.in, examples/Makefile.in,
	  src/Makefile.in : added 'uninstall' and 'uninstall-examples'
	  make target.

	* src/kahua-install.in : added -U (uninstall) option.

	* src/kahua-spvr.in : added (use srfi-1) to adapt the change of
	  util.list in post-0.7.3 Gauche.

2004-01-05  Shiro Kawai  <shiro@acm.org>

	* test/admin.scm : set up enviornment variables correctly so that
	  test can run without Kahua being installed.

2004-01-05 Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* test/admin.scm : add keyword ":wait" as #t to each run-process.

2004-01-05  Shiro Kawai  <shiro@acm.org>

	* src/kahua/config.scm (<kahua-config>):
	  typo fix :init-base -> :init-value

2004-01-04  Shiro Kawai  <shiro@acm.org>

	* src/Makefile.in (INSTALL_DIRS): added directory to install
	  kahua.* modules.

2004-01-02 Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* test/admin.scm : change to use cvs import, checkout.

2004-01-02 Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* src/kahua-admin.in : support cvs update. "cvs update [type]"

	* src/kahua/config.scm : add "repository" slot.

        * test/kahua-server.in (reload-server) : reload specifyed file.

	* test/admin.scm : add kahua-admin test program.

2003-12-29  Shiro Kawai  <shiro@acm.org>

	* src/kahua/test/xml.scm : The last fix about *test-error* is wrong.
	  If the test procedure gets *test-error* as input, it should return
	  #f---it never matches any pattern anyway.

2003-12-28  Shiro Kawai  <shiro@acm.org>

	* cgi/kahua.cgi.in (send-reply) : pass PATH_INFO information (after
	  removing ~user) to the server via "x-kahua-path-info" header
	  field.

2003-12-27  Shiro Kawai  <shiro@acm.org>

	* src/kahua/gsid.scm (make-worker-id), 
	  src/kahua/session.scm (make-cont-key): changed to use base-36
	  numbers instead of base-10, to shorten the key.

	* src/kahua/test/worker.scm : refactored out common procedures for
	  testing worker scripts.

	* src/kahua/test/xml.scm : test-* procedures (i.e. the ones to be
	  used in the last arg of test and test*) now returns *test-error*
	  when it receives *test-error*; attempting to parse *test-error*
	  results hard-to-track error messages.

	* test/worker.scm, test/lambdabooks.scm, test/wiki-iki.scm :
	  revised to use kahua.test.worker.

2003-12-26  Shiro Kawai  <shiro@acm.org>

	* examples/wiki-iki/* : added another example: simple wiki

2003-12-27  Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* src/kahua/config.scm(kahua-init): add "skip-check?" optional argument
	  to solve this problem:
	  http://www.kahua.org/mlarchive/kahua-dev/msg00142.html

2003-12-26  Shiro Kawai  <shiro@acm.org>

	* src/kahua-server.in : Let *.kahua be loaded in a separate module
	  kahua-app-server, which imports kahua and kahua-server by default.
	  This separation prevents accidental interference between kahua-server
	  code and *.kahua, and also avoid issues about module "use" ordering
	  (i.e. there was a case that the order of "use" of *.kahua wasn't
	  really the order of imports, since some modules were already loaded
	  in kahua-server code.  With this change, *.kahua has full control
	  over the order of imports).

	* src/kahua/html.scm (form/cont) : same change as a/cont, i.e.
	  using PATH_INFO to pass session key instead of x-kahua-cgsid.

	* test/lambdabooks.scm, test/worker.scm : adapted to form/cont change.

	* test/worker.scm : added back the code to clean up the test
	  worker process after each test section.

2003-12-25  Shiro Kawai  <shiro@acm.org>

	* src/kahua-spvr.in : added "restart" spvr command to restart
	  specified worker, for the convenience of development.

	* src/kahua-admin.in : fixed "ls" output format.

	* cgi/kahua.cgi.in: refactored PATH_INFO processing, allowing
	  generated cgsid to be passed via kahua.cgi/$worker-type/$cgsid
	  format.

	* src/kahua/session.scm: changed cont-session table, so that
	  the same cont-id will be returned when "known closure" is passed
	  to session-cont-register.  This change allows global entry
	  (defined via define-entry) to be treated in the same way as
	  local closures.

	* src/kahua/html.scm (a/cont): due to the above changes, a/cont
	  is much simplified.
	  (define-entry): does not only add-entry!, but also defines
	  global named procedure.

	* examples/lambdabooks/*.kahua, test/acont.kahua: adapted to
	  above changes.

2003-12-26  Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* cgi/kahua.cgi.in: fix regexp miss.

	* src/kahua-spvr.in: change app-servers format,
	  and a directory rule of checkout directory.
	  remove ":script" keyword, add ":arguments" keyword,
	  location of type.kahua to work/checkout/type/type.kahua

2003-12-25  Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* cgi/kahua.cgi.in:
	  support connecting user independent kahua-spvr with
	  path-info. If "~user" is given, read ~user/.kahua/kahua.conf
	  and perform with this configuration.

2003-12-23  Shiro Kawai  <shiro@acm.org>

	* examples/lambdabooks.kahua
	(standard-page-cont, standard-frame-cont):
	fixed a couple of leftovers of type inconsistencies.

2003-12-23  Nobuo Yamashita <nobsun@sampou.org>

	* examples/lambdabooks.kahua:
	fixed type inconsistencies.

	* src/kahua/html.scm (interp-html, interp-html-rec):
	old interp-html renamed to interp-html-rec.
	interp-html redefined without cont arg.

	* test/*.kahua:
	modified corresponding change of interp-html.

2003-12-22  Shiro Kawai  <shiro@acm.org>

	* src/kahua/persistence.scm (kahua-db-open, kahua-db-close) :
	added lock mechanism using fcntl(2).  NB: this might cause a
	problem on platforms that don't support fcntl(2) record lock.

2003-12-22  Nobuo Yamashita <nobsun@sampou.org>

	* examples/lambdabooks.kahua (standard-frame, standard-page):

	position of 'context' arg rearraged to be at last but 'cont' arg.
	(fixed bug: the previous commit did not changed them).

2003-12-21  Nobuo Yamashita <nobsun@sampou.org>

	* examples/lambdabooks.kahua (standard-frame, standard-page):
	* examples/lambdabooks/book.kahua (show-book-detail):
	* examples/lambdabooks/login.kahua (login-dialog, new-user): 
	local functions
	* examples/lambdabooks/review.kahua (show-reviews, write-review):
	* examples/lambdabooks/useradmin.kahua (user-edit-panel)
	local function
	
	position of 'context' arg rearraged to be at last but 'cont' arg.

	* examples/lambdabooks/lister.kahua (lister)

	modified args order and curried.

2003-12-21  Shiro Kawai  <shiro@acm.org>

	* src/kahua/test/xml.scm (match-pattern): added !contain
	directive.

	* test/test-xml.scm : added tests fo the above change.

2003-12-19  Shiro Kawai  <shiro@acm.org>

	* src/kahua/test/xml.scm
	(match-pattern) : treat attribute node (@ ...) specially; in it,
	patterns match any permutations of the input.
	(test-sxml-select-matcher, test-xml-select-matcher) : added
	higher-order test function parameterized by sxpath selection rule.

	* test/test-xml.scm : added tests for the above change.

2003-12-19  Nobuo Yamashita  <nobsun@sampou.org>

	* test/lambdabooks.scm:
	
	- Modified call-server/gsid and match&pick to keep sgsid.
	- Improved page checking pattern generation.
	- All pages are NOT YET covered. 

2003-12-15  Nobuo Yamashita  <nobsun@sampou.org>

	* test/lambdabooks.scm:
	Added code testing page transition for anonymous user.
	Still no code for loginuser.
	
2003-12-15  Nobuo Yamashita  <nobsun@sampou.org>

	* test/lambdabooks.scm:
	Added for testing examples/lambdabooks.kahua 
	The test script is work but not yet completed.

	* test/Makefile: 
	Added a entry for lambdabooks.scm.

	* examples/lambdabooks.init: 
	Changed specifyings for loading book.kahua and review.kahua
	to relative paths.

	* examples/Makefile.in:
	Modified command for excuting lambdabooks.init.
	

2003-12-15  Shiro Kawai  <shiro@acm.org>

	* cgi/kahua.cgi.in (compose-reply): sets Path parameter of the state
	session id cookie by the dirname of SCRIPT_NAME, to prevent clients
	from being confused by extra pathname components added after
	kahua.cgi.

2003-12-16  Koichi Sasada <sasada@namikilab.tuat.ac.jp>

	* src/kahua/gsid.scm : modified decompose-gsid to through
	invalid gsid. if called with invalid gsid, return (values #f gsid).

	* src/kahua/server.scm : added kahua-worker-type.

	* src/kahua/html.scm : syntax define-entry is added.
	 and modified a/cont to support named continuation.

	* test/worker.scm, test/gsid.scm, acont.kahua  : added tests to
	test above. worker.scm is added the test of named continuation with
	acont.kahua.

	* examples/lambdabooks.kahua, lambdabooks/books.kahua, 
	lambdabooks/partner.kahua, lambdabooks/useradmin.kahua :
	modified to use named continuation. 
	For example, to access partner ship page, you can access by
	"kahua.cgi/lambdabooks/partner-page".

2003-12-11  Nobuo Yamashita  <nobsun@sampou.org>

	* test/spvr.scm, test/worker.scm : revised.

	* test/hello-world.kahua, test/greeting.kahua, test/lister.kahua :
	Added for testing.

2003-12-11  Nobuo Yamashita  <nobsun@sampou.org>
	
	* version 0.1.1 :
	Made refactoring, most of kahua-elua integrated in kahua-server.

	Most of kahua/app/elua.scm code was included into kahua-server.
	kahua/app/elua/alt.scm --> kahua/html.scm
	Removed kahua/app/

	* configure.ac : modified version number from 0.1 to 0.2_pre0

	* cgi/ : removed kahua-dummy.cgi kahua-ekahi.cgi

	* cgi/Makefile.in : modified SCRITPTS from kahua-elua.cgi to kahua.cgi

	* examples/lambdabooks.kahua: removed (use kahua.app.elua.alt)

	* test/app/ : removed

	* test/Makefile : removed line for app subdirectory

	* test/gsid.scm : modified line for testing worker-id->sockaddr

	* test/spvr.scm, test/worker.scm : almost all test lines commented out.
	We *MUST* implement new testing

	* src/Makefile.in : adjusted for new version

	* src/kahua-dummy.in : removed

	* src/kahua-server.in :
	
	Added following definitions from src/kahua/app/elua.scm
	  primary-database-name
	  main-proc
	  initial-main-proc
	  handle-request
	  default-handler

	Modified part for initializing local work-id variable in main

	Modified load-kahua-module; use (load module) instead of (use module)
	
	* src/kahua-spvr.in :
	modified worker-types to '()

	* src/kahua.conf.sample :
	removed '-elua' from path names.

	* src/kahua.scm :
	added kahua.html in extend list

	* src/kahua/html.scm : added (almost same as old src/kahua/app/elua/alt.scm)

	* src/kahua/config.scm, src/kahua/gsid.scm : remove '-elua' from path names.

	* src/kahua/app/ : removed
	
2003-12-01  Shiro Kawai  <shiro@acm.org>

	* src/kahua/user.scm : added inactive flag to <kahua-user>.
	kahua-check-user returns #f if the matched user is inactive.

	* examples/lambdabooks/useradmin.kahua : enable display and
	edit of inactive slot of user instances.

2003-11-30  Shiro Kawai  <shiro@acm.org>

	* release 0.1: preliminary release.

2003-11-28  Shiro Kawai  <shiro@acm.org>

	* src/kahua/persistence.scm (kahua-db-sync): made the db argument
	optional; when omitted, assumes current-db.

	* src/kahua/app/elua.scm (primary-database-name, handle-request):
	application server can set a primary database name so that it is
	always opened while the handler is called.
	examples/lambadbooks is also changed to adapt to this feature.

	* src/kahua/user.scm (kahua-user-has-role?): added.
	* src/kahua/app/elua/alt.scm (not-accessible?): changed to check
	require-role aux node info against current user's roles.

	* examples/lambdabooks/useradmin.kahua : added user administration
	module.
	* examples/lambdabooks.init : make default users 'admin' and 'guest'.

2003-11-26  Shiro Kawai  <shiro@acm.org>

	* src/kahua/user.scm (kahua-add-user, kahua-check-user,
	kahua-find-user), test/register.kahua, test/user.scm,
	examples/lambdabooks/login.kahua :
	Renamed add-user and check-user for the names with kahua- prefix,
	and added kahua-find-user.  Fixed users of those APIs respectively.

	* src/kahua-admin.in, src/kahua/server.scm (kahua-default-handler):
	capture current-output and error-output during calling eval-proc,
	and send them to kahua-admin, so that external REPL interface
	can see those output.

	* examples/Makefile.in, examples/lambdabooks.init : allow to give
	alternative Kahua config file at install-examples time, via the
	KAHUACONFIG make varaible.  (Patch from K.Sasada).

	* src/Makefile.in : installs /etc/kahua.conf if it doesn't exist.
	
	* examples/app-servers.sample, examples/Makefile.in : installs
	sample app-servers file by "make install-examples" iff there's no
	app-servers file.
	
	* src/kahua-install.in: added -r (rename) and --no-overwrite option.

	* src/kahua/server.scm (kahua-context-add, kahua-context-ref,
	kahua-current-user) : moved these from kahua.app.elua.alt and
	lambdabooks.kahua, making them as standard API.

	* examples/lambdabooks.kahua, examples/lambdabooks/* :
	refactored individual modules.

	* src/kahua/persistence.scm (kahua-object): fixed a problem that
	instance-by-key table of database wasn't initialized properly
	when a persistent instance was read from the disk.

2003-11-25  Shiro Kawai  <shiro@acm.org>

	* Makefile.in's, INSTALL : preparing packaging and installation.
	
	* src/kahua-install.in : added.

	* all files : added copyright notice.

	* src/Makefile.in, src/*.in, src/fix-shebang.sh : substitute the
	first shebang line of executable scripts at make time.

	* src/kahua/config.scm : added static-document-path and
	static-document-url in configuration parameters.

	* examples/lambadbooks.kahua, examples/lambdabooks/* :
	moved from test/lambdabooks.kahua, and splitted to several files.

	* test/lambdabooks.kahua, images/* : moved under examples.

2003-11-24  Shiro Kawai  <shiro@acm.org>

	* emacs/Makefile.in, emacs/kahua.el.in : added emacs interface
	(very simple one; just for starting point).

	* src/kahua/app/elua/alt.scm : added.  a trial implementation of
	  continuation-passing style interp-html.
	* test/lambdabooks.kahua : added.  a sample site to test
	  kahua.app.elua.alt.

	* images/* : added.  general image directory.  currently contains
	  some images used by lambdabooks.kahua.

	* src/kahua/persistence.scm : fixed a problem that <kahua-proxy>
	wasn't realized if the slot contains a list of persistent objects,
	and a problem that instances that are read from disk are inadvertently
	marked dirty.

2003-11-21  Shiro Kawai  <shiro@acm.org>

	* cgi/kahua-elua.cgi : now it can dispatch session-initiating
	request to different types of app-servers by looking at PATH_INFO,
	e.g. http://foo/bar/kahua-elua.cgi/register to connect to register app.

2003-11-20  Shiro Kawai  <shiro@acm.org>

	* test/spvr.scm : fixed path problem for loading *.kahua from
	child processes.

	* test/worker.scm : added some tests for evaluate handler.

	* src/kahua/server.scm (kahua-default-handler) :
	Added evaluate handler for emacs interface.

	* src/kahua/app/elua.scm : adapted to kahua.server change.  fixed
	a bug in init-server that returns wrong worker name.

	* src/kahua/persistence.scm (make-kahua-collection):
	* src/test/user.scm :
	Fixed a bug that caused an error when there's no instance in the
	specified class.

	* src/kahua-admin :
	Handles 'shutdown' command specially to avoid stale error message.
	Added code to connect and interact with workers, using evaluate
	handler of kahua.server.
	
	* src/kahua-spvr :
	Loads application server specification from the
	$(working-directory)/app-server file.  It can be reloaded by
	'reload' spvr command, without restarting kahua-spvr.
	Also added 'register' service.  Run check-workers for every second
	using timeout.

2003-11-20  Nobuo Yamashita <nobsun@sampou.org>

	* src/kahua/app/elua/html.scm :
	Modified form/cont to indicate input args' name as continuation.

	* test/greeting.kahua :
	Added for testing new form/cont

	* test/worker.scm :
	Added match&pick-form for testing form/cont, but i wonder if 
	it's correct. 

2003-11-17  Nobuo Yamashita <nobsun@sampou.org>

	* src/kahua/app/elua/html.scm :
	* test/lister.kahua : 
	change to use context instead of main-proc-args, because
	main-proc-args is global for service.

	* src/kahua-spvr : hard-coded for lister service
	
	* test/worker.scm : add test for lister.kahua continuation

2003-11-17  Nobuo Yamashita <nobsun@sampou.org>
	
	* src/kahua/app/elua/control.scm : remove items in export list
	
	* src/kahua/app/elua/html.scm : fixed bug in a/cont and form/cont

2003-11-14  Nobuo Yamashita <nobsun@sampou.org>

	* test/app/work.scm :
	test for interp-html in src/kahua/app/elua/*

	* test/app/hello-world.kahua :
	* test/app/lister.kahua :
	sample applications for testing src/kahua/app/elua/*
		
2003-11-14  Shiro Kawai  <shiro@acm.org>

	* src/kahua/app/elua/*, test/app/* : start integrating domain
	  specific language code.

	* src/kahua/persistence.scm : make it work with both Gauche 0.7.2
	  and 0.7.3_pre1.

	* src/kahua/config.scm : adds $(working-directory)/checkout to
	  load-path.

	* src/kahua-spvr : added 'test' worker type that uses test.kahua.

2003-11-13  Shiro Kawai  <shiro@acm.org>

	* src/kahua/server.scm, test/server.scm, src/kahua/app/ekahi.scm :
	  refactored common stuff from ekahi.scm into kahua.server module.

	* src/kahua/user.scm, test/user.scm : let add-user return #f
	  if a user with the same login name exists, instead of raising
	  an error.

	* src/kahua/session.scm, test/session.scm : added kahua.session
	  module.

2003-11-08  Shiro Kawai  <shiro@acm.org>

	* src/kahua-spvr, src/kahua-admin : added supervisor command
	  processing feature for kahua-spvr, and a script kahua-admin
	  to control the suppervisor process.
	
	* src/kahua/config.scm : new module to handle configuration file
	* src/kahua-spvr, test/test.conf, test/spvr.scm, src/Makefile.in :
	  adapted to kahua.config.

2003-11-05  Shiro Kawai  <shiro@acm.org>

	* src/kahua/app/ekahi.scm, cgi/kahua-ekahi.cgi : working snapshot
	  of kahua.app.ekahi

	* src/kahua/test/xml.scm : packaged kahua-ekahi's kahua-test
	  as a module.

2003-11-04  Shiro Kawai  <shiro@acm.org>

	* src/kahua-server, src/kahua/app/dummy.scm : added loadable
	  application server framework.

2003-11-03  Shiro Kawai  <shiro@acm.org>

	* src/kahua-spvr, src/kahua-dummy : changed the invocation protocol
	  of application server; now sockbase is passed via -s option.

2003-10-29  Shiro Kawai  <shiro@acm.org>

	* src/kahua-spvr, src/kahua-dummy : added the basic framework of
	  servers.

2003-10-28  Shiro Kawai  <shiro@acm.org>

	* src/kahua/gsid.scm, test/gsid.scm : added provisional session ID
	  stuff.

2003-10-27  Shiro Kawai  <shiro@acm.org>

	* Checked in the stuff about persistent storage
	  (src/kahua/persistence.scm, test/persistence.scm).  They are just
	  a placeholder and will be replaced by the "real" database later.

